{{ $original := .Page.Resources.GetMatch .Destination }}

{{ if and $original (ne (path.Ext .Destination) ".gif") }}
{{/*
Resize ALL images to a consistent maximum width of 800px.
This is the standard for creating a clean, column-like layout.
Portrait images will be 800px wide and tall.
Landscape images will be 800px wide and short.
Hugo's ".Resize" function automatically handles the EXIF rotation.
*/}}
{{ $thumb := $original.Resize "800x" }}

<figure class="render-hook-figure">

    <a href="https://cdn.jsdelivr.net/gh/shpandrak/shpandrak.github.io@main/content/{{.Page.Path}}/{{.Destination}}" class="gallery-item" data-caption="{{ .Title | default .Text }}">
        <img
                src="{{ $thumb.Permalink }}"
                alt="{{ .Text }}"
                width="{{ $thumb.Width }}"
                height="{{ $thumb.Height }}">
    </a>

    {{ if .Title }}
    <figcaption>{{ .Title | markdownify }}</figcaption>
    {{ end }}
</figure>
{{ else }}
{{/* If the image is not local (e.g., from another website), display it normally */}}
<figure class="render-hook-figure">
    {{- if $original -}}
    <img src="{{ $original.Permalink }}" alt="{{ .Text }}">
    {{- else -}}

    <img src="{{ .Destination | safeURL }}" alt="{{ .Text }}">
    {{- end -}}
</figure>
{{ end }}